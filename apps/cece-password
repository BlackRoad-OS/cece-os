#!/bin/bash
# CECE-PASSWORD v1.0 - Our Own LastPass/Bitwarden
PASS_DIR=~/cece/passwords
mkdir -p "$PASS_DIR"

generate() {
    LENGTH="${1:-16}"
    cat /dev/urandom | tr -dc "a-zA-Z0-9!@#$%^&*" | head -c $LENGTH
    echo ""
}

save() {
    SITE="$1"
    USER="$2"
    PASS="$3"
    ENCODED=$(echo "$PASS" | base64)
    echo "user: $USER" > "$PASS_DIR/$SITE.pass"
    echo "pass: $ENCODED" >> "$PASS_DIR/$SITE.pass"
    echo "Saved credentials for $SITE"
}

get() {
    SITE="$1"
    if [ -f "$PASS_DIR/$SITE.pass" ]; then
        USER=$(grep "user:" "$PASS_DIR/$SITE.pass" | cut -d: -f2-)
        ENCODED=$(grep "pass:" "$PASS_DIR/$SITE.pass" | cut -d: -f2-)
        PASS=$(echo "$ENCODED" | base64 -d)
        echo "Site: $SITE"
        echo "User:$USER"
        echo "Pass: $PASS"
    else
        echo "Not found"
    fi
}

list() {
    echo "SAVED PASSWORDS"
    for p in "$PASS_DIR"/*.pass 2>/dev/null; do
        [ -f "$p" ] && echo "  $(basename $p .pass)"
    done
}

case "$1" in
    generate) generate "$2" ;;
    save) save "$2" "$3" "$4" ;;
    get) get "$2" ;;
    list) list ;;
    *) echo "CECE-PASSWORD: generate [len] | save <site> <user> <pass> | get <site> | list" ;;
esac
