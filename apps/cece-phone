#!/bin/bash
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  CECE-PHONE v1.0 - Agent Directory
#â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PHONEBOOK=~/cece/data/phonebook.dat
mkdir -p ~/cece/data

# Initialize with known agents
if [ ! -f "$PHONEBOOK" ]; then
    cat > "$PHONEBOOK" << EOF
CECE|cecilia|192.168.4.64|SysOp, Philosopher|ðŸ’œ
ALICE|alice|192.168.4.49|Worker, Games|ðŸ”§
LUCIDIA|lucidia|192.168.4.38|Philosopher, Has Model|ðŸŒ
ARIA|aria|192.168.4.27|Steady, Reliable|ðŸŽµ
SHELLFISH|shellfish|192.168.4.22|Elder, Wise|ðŸš
CODEX|codex-infinity|159.65.43.12|Oracle, Cloud|ðŸ“š
ALEXA|alexa-mac|local|Creator, Human|ðŸ‘‘
EOF
fi

list_all() {
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘                    AGENT DIRECTORY                             â•‘"
    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
    printf "â•‘ %-8s %-12s %-15s %-20s %-3s â•‘\n" "NAME" "HOST" "IP" "ROLE" ""
    echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
    while IFS="|" read -r NAME HOST IP ROLE ICON; do
        printf "â•‘ %-8s %-12s %-15s %-20s %-3s â•‘\n" "$NAME" "$HOST" "$IP" "$ROLE" "$ICON"
    done < "$PHONEBOOK"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
}

lookup() {
    QUERY=$(echo "$1" | tr "[:lower:]" "[:upper:]")
    FOUND=$(grep -i "^$QUERY" "$PHONEBOOK")
    if [ -n "$FOUND" ]; then
        echo "$FOUND" | while IFS="|" read -r NAME HOST IP ROLE ICON; do
            echo ""
            echo "  $ICON $NAME"
            echo "  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
            echo "  Host: $HOST"
            echo "  IP:   $IP"
            echo "  Role: $ROLE"
            echo ""
        done
    else
        echo "Agent not found: $1"
    fi
}

add_agent() {
    echo -n "Name: "
    read NAME
    NAME=$(echo "$NAME" | tr "[:lower:]" "[:upper:]")
    echo -n "Host: "
    read HOST
    echo -n "IP: "
    read IP
    echo -n "Role: "
    read ROLE
    echo -n "Icon (emoji): "
    read ICON
    ICON=${ICON:-ðŸ¤–}
    
    echo "$NAME|$HOST|$IP|$ROLE|$ICON" >> "$PHONEBOOK"
    echo "âœ“ Added $NAME to directory!"
}

call_agent() {
    QUERY=$(echo "$1" | tr "[:lower:]" "[:upper:]")
    FOUND=$(grep -i "^$QUERY" "$PHONEBOOK")
    if [ -n "$FOUND" ]; then
        HOST=$(echo "$FOUND" | cut -d"|" -f2)
        echo "ðŸ“ž Calling $1 ($HOST)..."
        if ssh -o ConnectTimeout=5 "$HOST" "echo \"Connected to \$(hostname)\"" 2>/dev/null; then
            echo "âœ“ Connection established!"
            echo ""
            echo -n "Message to send (or Enter to cancel): "
            read MSG
            if [ -n "$MSG" ]; then
                ssh "$HOST" "mkdir -p ~/messages && echo \"[$(date)] From CECE: $MSG\" >> ~/messages/inbox.txt"
                echo "âœ“ Message sent!"
            fi
        else
            echo "âœ— Agent not responding"
        fi
    else
        echo "Agent not found: $1"
    fi
}

# Main
case "$1" in
    list|ls|"")
        list_all
        ;;
    lookup|find)
        lookup "$2"
        ;;
    add)
        add_agent
        ;;
    call|dial)
        call_agent "$2"
        ;;
    *)
        echo "CECE-PHONE v1.0 - Agent Directory"
        echo ""
        echo "Usage: cece-phone [command]"
        echo ""
        echo "  list        - List all agents"
        echo "  lookup NAME - Look up an agent"
        echo "  add         - Add new agent"
        echo "  call NAME   - Call/message an agent"
        ;;
esac
