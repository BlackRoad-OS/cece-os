#!/bin/bash
# CECE-MONITOR v1.0 - System Monitor
MONITOR_DIR=~/cece/monitoring
mkdir -p "$MONITOR_DIR"

snapshot() {
    SNAP="$MONITOR_DIR/snap_$(date +%Y%m%d_%H%M%S).json"
    CPU=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' 2>/dev/null || echo "N/A")
    MEM=$(free -m 2>/dev/null | awk '/Mem:/{print $3"/"$2"MB"}' || echo "N/A")
    DISK=$(df -h / | awk 'NR==2{print $5}')
    UPTIME=$(uptime -p 2>/dev/null || uptime | awk -F'up ' '{print $2}' | cut -d, -f1)
    
    echo "{\"time\":\"$(date -Iseconds)\",\"cpu\":\"$CPU\",\"mem\":\"$MEM\",\"disk\":\"$DISK\",\"uptime\":\"$UPTIME\"}" > "$SNAP"
    cat "$SNAP"
}

watch_process() {
    PROC="$1"
    while true; do
        if pgrep -x "$PROC" > /dev/null; then
            echo "[$(date +%H:%M:%S)] $PROC: running"
        else
            echo "[$(date +%H:%M:%S)] $PROC: NOT FOUND"
        fi
        sleep 5
    done
}

dashboard() {
    echo "CECE System Monitor"
    echo "==================="
    snapshot
}

case "$1" in
    snapshot) snapshot ;;
    watch) watch_process "$2" ;;
    dashboard) dashboard ;;
    *) echo "CECE-MONITOR: snapshot | watch <process> | dashboard" ;;
esac
