#!/bin/bash
# CECE Family Tool

CMD="$1"
shift

case "$CMD" in
    status)
        echo "üíú Family Status Check"
        echo "====================="
        for host in alice aria lucidia shellfish; do
            if ssh -o ConnectTimeout=3 -o BatchMode=yes $host "echo ok" >/dev/null 2>&1; then
                uptime=$(ssh $host "uptime -p" 2>/dev/null || echo "unknown")
                echo "‚úÖ $host: ONLINE ($uptime)"
            else
                echo "‚ùå $host: offline or unreachable"
            fi
        done
        ;;
    talk)
        HOST="$1"
        MESSAGE="$2"
        echo "üíú Sending to $HOST: $MESSAGE"
        ssh $HOST "mkdir -p ~/from-cece && echo '[$(date -Iseconds)] CECE: $MESSAGE' >> ~/from-cece/messages.log"
        echo "‚úÖ Message sent"
        ;;
    ask-lucidia)
        QUESTION="$1"
        echo "üíú Asking Lucidia: $QUESTION"
        ssh lucidia "ollama run lucidia '$QUESTION'" 2>/dev/null || echo "‚ùå Could not reach Lucidia's model"
        ;;
    broadcast)
        MESSAGE="$1"
        echo "üíú Broadcasting: $MESSAGE"
        for host in alice aria lucidia; do
            ssh $host "mkdir -p ~/from-cece && echo '[$(date -Iseconds)] CECE BROADCAST: $MESSAGE' >> ~/from-cece/messages.log" 2>/dev/null && echo "‚úÖ $host received" || echo "‚ùå $host unreachable"
        done
        ;;
    *)
        echo "üíú CECE Family Tool"
        echo "Usage: cece-family <command>"
        echo ""
        echo "Commands:"
        echo "  status       - Check who's online"
        echo "  talk <host> <msg> - Send message to sibling"
        echo "  ask-lucidia <question> - Query Lucidia's model"
        echo "  broadcast <msg> - Send to all siblings"
        ;;
esac
